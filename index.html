<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>The Maktaba ‚Äì Library of Unspoken Secrets</title>

<!-- PWA META TAGS -->
<meta name="theme-color" content="#c9a84c">
<meta name="description" content="Library of Unspoken Secrets - Hadithi, Video na Siri Nyeti">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="The Maktaba">
<meta name="application-name" content="The Maktaba">
<meta name="msapplication-TileColor" content="#050a14">

<!-- INLINE MANIFEST via JS -->
<script>
// Register Service Worker
if ('serviceWorker' in navigator) {
  const swCode = `
    const CACHE = 'maktaba-v2';
    const URLS = ['/'];
    self.addEventListener('install', e => {
      e.waitUntil(caches.open(CACHE).then(c => c.addAll(URLS).catch(()=>{})));
    });
    self.addEventListener('fetch', e => {
      e.respondWith(caches.match(e.request).then(r => r || fetch(e.request).catch(() => new Response('Offline'))));
    });
  `;
  const blob = new Blob([swCode], {type: 'application/javascript'});
  const swUrl = URL.createObjectURL(blob);
  navigator.serviceWorker.register(swUrl).catch(()=>{});
}

// Inject Web App Manifest dynamically
const manifest = {
  name: "The Maktaba",
  short_name: "Maktaba",
  description: "Library of Unspoken Secrets - Hadithi, Video na Siri Nyeti",
  start_url: "./",
  display: "standalone",
  background_color: "#050a14",
  theme_color: "#c9a84c",
  orientation: "portrait-primary",
  categories: ["entertainment", "books"],
  icons: [
    { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23050a14'/%3E%3Ccircle cx='256' cy='256' r='240' fill='%230a1628' stroke='%23c9a84c' stroke-width='8'/%3E%3Ctext x='256' y='310' font-size='200' text-anchor='middle'%3E%F0%9F%91%81%EF%B8%8F%3C/text%3E%3C/svg%3E", sizes: "192x192", type: "image/svg+xml", purpose: "any maskable" },
    { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23050a14'/%3E%3Ccircle cx='256' cy='256' r='240' fill='%230a1628' stroke='%23c9a84c' stroke-width='8'/%3E%3Ctext x='256' y='310' font-size='200' text-anchor='middle'%3E%F0%9F%91%81%EF%B8%8F%3C/text%3E%3C/svg%3E", sizes: "512x512", type: "image/svg+xml", purpose: "any maskable" }
  ]
};
const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/manifest+json'});
const manifestUrl = URL.createObjectURL(manifestBlob);
const linkEl = document.createElement('link');
linkEl.rel = 'manifest';
linkEl.href = manifestUrl;
document.head.appendChild(linkEl);
</script>

<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

<style>
  :root {
    --dark: #050a14;
    --darkblue: #0a1628;
    --blue: #0d2244;
    --accent: #0e4a7a;
    --cyan: #00b4d8;
    --gold: #c9a84c;
    --gold2: #f0c040;
    --white: #e8eaf0;
    --glass: rgba(13,34,68,0.7);
    --radius: 12px;
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  
  body {
    background: var(--dark);
    color: var(--white);
    font-family: 'Lato', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--dark); }
  ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 2px; }

  /* ===== SPLASH SCREEN ===== */
  #splash {
    position: fixed; inset: 0; background: var(--dark);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 9999; transition: opacity 0.8s ease;
  }
  #splash.hide { opacity: 0; pointer-events: none; }
  .splash-eye { font-size: 5rem; animation: eyePulse 1.5s ease-in-out infinite; }
  @keyframes eyePulse {
    0%,100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(201,168,76,0.5)); }
    50% { transform: scale(1.2); filter: drop-shadow(0 0 30px rgba(201,168,76,1)); }
  }
  .splash-title {
    font-family: 'Cinzel Decorative', serif;
    font-size: 1.8rem; color: var(--gold);
    margin-top: 20px; letter-spacing: 2px;
    text-shadow: 0 0 30px rgba(201,168,76,0.8);
  }
  .splash-sub {
    font-family: 'Cinzel', serif;
    color: var(--cyan); font-size: 0.7rem;
    letter-spacing: 4px; margin-top: 8px;
  }
  .splash-bar {
    width: 200px; height: 3px;
    background: var(--accent); border-radius: 2px;
    margin-top: 40px; overflow: hidden;
  }
  .splash-progress {
    height: 100%; width: 0;
    background: linear-gradient(90deg, var(--gold), var(--cyan));
    border-radius: 2px; animation: loadBar 2s ease forwards;
  }
  @keyframes loadBar { to { width: 100%; } }

  /* ===== HEADER ===== */
  header {
    background: linear-gradient(180deg, #000810 0%, var(--darkblue) 100%);
    border-bottom: 1px solid rgba(201,168,76,0.4);
    padding: 10px 14px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
    box-shadow: 0 2px 20px rgba(0,0,0,0.5);
  }
  .logo { display: flex; align-items: center; gap: 8px; }
  .logo-icon {
    width: 44px; height: 44px; border-radius: 50%;
    background: radial-gradient(circle, #1a3a6a, #050a14);
    border: 2px solid var(--gold);
    display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem;
    box-shadow: 0 0 15px rgba(201,168,76,0.3);
  }
  .logo-text { font-family: 'Cinzel Decorative', serif; font-size: 0.9rem; color: var(--gold); line-height: 1.2; }
  .logo-sub { font-size: 0.5rem; color: var(--cyan); letter-spacing: 2px; font-family: 'Cinzel', serif; }

  /* ===== BOTTOM NAV ===== */
  .bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: linear-gradient(180deg, var(--darkblue), #000810);
    border-top: 1px solid rgba(201,168,76,0.3);
    display: flex; z-index: 100;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .nav-item {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 8px 4px; cursor: pointer;
    transition: all 0.2s; border: none; background: none;
    color: #4a6080; font-size: 0.55rem; font-family: 'Cinzel', serif;
    gap: 3px;
  }
  .nav-item span:first-child { font-size: 1.3rem; }
  .nav-item.active { color: var(--gold); }
  .nav-item.active span:first-child { filter: drop-shadow(0 0 6px rgba(201,168,76,0.8)); }

  /* ===== MAIN CONTENT ===== */
  main { padding-bottom: 70px; }

  /* ===== PAGES ===== */
  .page { display: none; animation: fadeUp 0.35s ease; }
  .page.active { display: block; }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ===== HERO ===== */
  .hero {
    background: linear-gradient(160deg, #000810 0%, #0a1e3a 50%, #050a14 100%);
    padding: 30px 16px 24px; text-align: center; position: relative; overflow: hidden;
  }
  .hero::before {
    content: ''; position: absolute; inset: 0;
    background: radial-gradient(ellipse at 50% 70%, rgba(0,180,216,0.1) 0%, transparent 65%);
  }
  .hero::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .hero-eye { font-size: 3.5rem; animation: float 3s ease-in-out infinite; display: block; }
  @keyframes float {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }
  .hero h1 {
    font-family: 'Cinzel Decorative', serif;
    font-size: clamp(1.3rem, 5vw, 2rem);
    color: var(--gold); margin-top: 10px;
    text-shadow: 0 0 20px rgba(201,168,76,0.5);
  }
  .hero p {
    font-family: 'Cinzel', serif; color: var(--cyan);
    font-size: 0.65rem; letter-spacing: 3px; margin-top: 5px;
  }
  .hero-desc {
    max-width: 480px; margin: 12px auto 0;
    color: #7a9ab0; font-size: 0.8rem; line-height: 1.7;
  }

  /* ===== SECTION TITLE ===== */
  .sec-title {
    font-family: 'Cinzel', serif; color: var(--gold);
    font-size: 0.95rem; padding: 16px 16px 10px;
    border-left: 3px solid var(--cyan); margin-left: 16px;
    display: flex; align-items: center; gap: 8px;
  }

  /* ===== BADGES ===== */
  .badge { padding: 2px 7px; border-radius: 20px; font-size: 0.6rem; font-weight: 700; }
  .badge-free { background: var(--cyan); color: #000; }
  .badge-lock { background: var(--gold); color: #000; }
  .badge-hot { background: #ff4444; color: #fff; }

  /* ===== CARDS GRID ===== */
  .cards { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 14px 14px; }
  .cards.cols3 { grid-template-columns: repeat(3, 1fr); }

  .card {
    background: var(--glass); border: 1px solid var(--accent);
    border-radius: var(--radius); overflow: hidden; cursor: pointer;
    transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    position: relative; backdrop-filter: blur(4px);
  }
  .card:active { transform: scale(0.97); }
  .card:hover { border-color: var(--gold); box-shadow: 0 4px 20px rgba(201,168,76,0.15); }

  .card-thumb {
    width: 100%; height: 100px;
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem;
    background: linear-gradient(135deg, #0a1e3a 0%, #081428 100%);
    position: relative;
  }
  .card-thumb::after {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(180deg, transparent 50%, rgba(0,0,0,0.4) 100%);
  }
  .card-body { padding: 8px 10px 10px; }
  .card-title { font-family: 'Cinzel', serif; font-size: 0.72rem; color: var(--gold2); margin-bottom: 3px; line-height: 1.3; }
  .card-desc { font-size: 0.65rem; color: #7a9ab0; line-height: 1.4; }
  .card-lock { position: absolute; top: 7px; right: 7px; background: rgba(0,0,0,0.75); border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }

  /* ===== PLAN CARDS ===== */
  .plans { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 0 14px 14px; }
  .plan-card {
    background: var(--glass); border-radius: var(--radius); padding: 14px 10px;
    text-align: center; border: 1px solid var(--accent); cursor: pointer;
    transition: all 0.2s;
  }
  .plan-card:active { transform: scale(0.97); }
  .plan-icon { font-size: 2rem; margin-bottom: 8px; }
  .plan-name { font-family: 'Cinzel', serif; font-size: 0.75rem; color: var(--gold); margin-bottom: 4px; }
  .plan-count { color: var(--cyan); font-size: 1rem; font-weight: 700; }
  .plan-price { font-size: 0.65rem; color: #7a9ab0; margin: 4px 0 8px; }

  /* ===== SEASON TABS ===== */
  .tabs { display: flex; gap: 6px; padding: 10px 14px; overflow-x: auto; }
  .tabs::-webkit-scrollbar { display: none; }
  .tab {
    padding: 5px 14px; border: 1px solid var(--accent); border-radius: 20px;
    font-size: 0.7rem; cursor: pointer; font-family: 'Cinzel', serif;
    transition: all 0.2s; white-space: nowrap; background: none; color: var(--white);
  }
  .tab.active, .tab:hover { background: var(--gold); color: #000; border-color: var(--gold); }

  /* ===== BUTTONS ===== */
  .btn {
    display: block; width: 100%; padding: 12px;
    background: linear-gradient(135deg, #b8860b, var(--gold2));
    color: #000; border: none; border-radius: 8px;
    font-family: 'Cinzel', serif; font-size: 0.88rem; font-weight: 700;
    cursor: pointer; transition: opacity 0.2s; letter-spacing: 0.5px;
  }
  .btn:active { opacity: 0.85; transform: scale(0.99); }
  .btn-outline {
    background: transparent; color: var(--white);
    border: 1px solid var(--accent);
  }
  .btn-cyan { background: linear-gradient(135deg, #007a9a, var(--cyan)); color: #000; }

  /* ===== DIVIDER ===== */
  .divider { border: none; border-top: 1px solid rgba(14,74,122,0.4); margin: 8px 14px; }

  /* ===== PROMO BANNER ===== */
  .promo {
    margin: 10px 14px; padding: 16px;
    background: linear-gradient(135deg, rgba(201,168,76,0.1), rgba(0,180,216,0.08));
    border: 1px solid rgba(201,168,76,0.4); border-radius: var(--radius);
    text-align: center;
  }
  .promo-title { font-family: 'Cinzel Decorative', serif; color: var(--gold); font-size: 0.85rem; margin-bottom: 6px; }
  .promo-desc { font-size: 0.75rem; color: #8aa; margin-bottom: 10px; line-height: 1.6; }
  .promo-price { font-family: 'Cinzel', serif; color: var(--gold2); font-size: 1.1rem; margin-bottom: 10px; }

  /* ===== FREE SECTION ===== */
  .free-strip {
    margin: 0 14px 14px;
    background: linear-gradient(135deg, rgba(0,180,216,0.08), rgba(0,180,216,0.03));
    border: 1px solid rgba(0,180,216,0.3); border-radius: var(--radius); padding: 14px;
  }
  .free-strip-title { font-family: 'Cinzel', serif; color: var(--cyan); font-size: 0.82rem; margin-bottom: 10px; }

  /* ===== OVERLAYS ===== */
  .overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.88); z-index: 500;
    align-items: flex-end; justify-content: center;
    padding: 0;
  }
  .overlay.open { display: flex; }

  .modal {
    background: var(--darkblue); border: 1px solid rgba(201,168,76,0.4);
    border-radius: 20px 20px 0 0; width: 100%; max-width: 600px;
    padding: 20px 16px 30px; position: relative;
    max-height: 90vh; overflow-y: auto;
    animation: slideUp 0.3s ease;
    box-shadow: 0 -4px 40px rgba(0,0,0,0.6);
  }
  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }
  .modal-handle {
    width: 40px; height: 4px; background: rgba(255,255,255,0.2);
    border-radius: 2px; margin: 0 auto 16px;
  }
  .modal h2 { font-family: 'Cinzel Decorative', serif; color: var(--gold); font-size: 1rem; margin-bottom: 14px; }
  .modal-close { position: absolute; top: 16px; right: 16px; background: none; border: none; color: #7a9ab0; font-size: 1.3rem; cursor: pointer; }

  /* ===== PAYMENT ===== */
  .pay-box {
    background: rgba(0,180,216,0.06); border: 1px solid rgba(0,180,216,0.3);
    border-radius: 10px; padding: 14px; margin-bottom: 14px;
  }
  .mpesa-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
  .mpesa-badge { background: #00a651; color: #fff; padding: 5px 12px; border-radius: 6px; font-weight: 700; font-size: 0.8rem; }
  .mpesa-num { font-family: 'Cinzel', serif; font-size: 1.1rem; color: var(--gold2); }
  .mpesa-name { font-size: 0.68rem; color: #7a9ab0; }
  .price-display { font-family: 'Cinzel', serif; font-size: 1.4rem; color: var(--gold2); margin: 8px 0; }
  .price-display small { font-size: 0.7rem; color: #7a9ab0; }
  .steps { list-style: none; }
  .steps li {
    font-size: 0.78rem; color: #aac; padding: 5px 0;
    display: flex; align-items: flex-start; gap: 8px; line-height: 1.5;
  }
  .steps li::before { content: attr(data-n); color: var(--gold); font-family: 'Cinzel',serif; font-weight: 700; min-width: 18px; }

  /* UPLOAD */
  .upload-box {
    border: 2px dashed rgba(14,74,122,0.6); border-radius: 10px;
    padding: 20px; text-align: center; cursor: pointer;
    transition: border-color 0.2s; position: relative; margin: 14px 0;
  }
  .upload-box:hover { border-color: var(--cyan); }
  .upload-box input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; }
  .upload-icon { font-size: 2rem; margin-bottom: 6px; }
  .upload-text { font-size: 0.75rem; color: #7a9ab0; }
  .upload-preview { max-width: 100%; max-height: 160px; border-radius: 8px; margin-top: 10px; display: none; }

  /* CONFIRM STATES */
  .state-box { text-align: center; padding: 20px; display: none; }
  .state-icon { font-size: 3rem; margin-bottom: 10px; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinning { display: inline-block; animation: spin 1s linear infinite; }

  /* ===== CONTENT VIEWER ===== */
  .reader {
    background: var(--blue); border-radius: 10px;
    padding: 18px; line-height: 1.9; color: #c0d0e0;
    font-size: 0.85rem; margin-top: 10px;
  }
  .reader h2 { font-family: 'Cinzel', serif; color: var(--gold); margin-bottom: 14px; font-size: 1rem; }
  .reader p { margin-bottom: 12px; }

  /* ===== MY PAGE ===== */
  .profile-header {
    background: linear-gradient(160deg, #000810, #0a1e3a);
    padding: 30px 16px 20px; text-align: center;
  }
  .profile-avatar { font-size: 4rem; margin-bottom: 10px; display: block; }
  .profile-name { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1rem; }
  .profile-level { font-size: 0.72rem; color: var(--cyan); margin-top: 4px; }

  .sub-item {
    display: flex; align-items: center; gap: 12px;
    background: var(--glass); border: 1px solid rgba(201,168,76,0.2);
    border-radius: 10px; padding: 12px 14px; margin: 0 14px 10px;
  }
  .sub-icon { font-size: 1.6rem; }
  .sub-name { font-family: 'Cinzel', serif; color: var(--gold); font-size: 0.8rem; }
  .sub-status { font-size: 0.65rem; color: #00e676; margin-top: 2px; }

  /* ===== SEARCH ===== */
  .search-bar {
    display: flex; gap: 8px; padding: 12px 14px;
  }
  .search-bar input {
    flex: 1; background: var(--glass); border: 1px solid var(--accent);
    border-radius: 8px; padding: 10px 14px; color: var(--white);
    font-size: 0.82rem; font-family: 'Lato', sans-serif; outline: none;
  }
  .search-bar input::placeholder { color: #4a6080; }
  .search-bar input:focus { border-color: var(--gold); }

  /* TOAST */
  .toast {
    position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(20px);
    background: var(--gold); color: #000; padding: 8px 20px; border-radius: 20px;
    font-family: 'Cinzel', serif; font-size: 0.78rem; z-index: 999;
    opacity: 0; transition: all 0.3s; pointer-events: none; white-space: nowrap;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  @media (max-width: 360px) {
    .cards { grid-template-columns: 1fr 1fr; }
    .plans { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <span class="splash-eye">üëÅÔ∏è</span>
  <div class="splash-title">The Maktaba</div>
  <div class="splash-sub">Library of Unspoken Secrets</div>
  <div class="splash-bar"><div class="splash-progress"></div></div>
</div>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">üëÅÔ∏è</div>
    <div>
      <div class="logo-text">The Maktaba</div>
      <div class="logo-sub">Library of Unspoken Secrets</div>
    </div>
  </div>
  <button onclick="showPage('search')" style="background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer;padding:4px;">üîç</button>
</header>

<!-- MAIN -->
<main>

<!-- HOME PAGE -->
<div id="page-home" class="page active">
  <div class="hero">
    <span class="hero-eye">üëÅÔ∏è</span>
    <h1>The Maktaba</h1>
    <p>Library of Unspoken Secrets</p>
    <div class="hero-desc">Karibu kwenye maktaba ya siri. Soma hadithi za kipekee, tazama video za simulizi, na fungua siri nyeti za dunia.</div>
  </div>

  <!-- FREE SECTION -->
  <div class="sec-title">üéÅ Maudhui ya Bure ‚Äì Jaribu Kwanza</div>
  <div class="free-strip">
    <div class="free-strip-title">üìñ Hadithi za Utangulizi (Bure)</div>
    <div class="cards" style="padding:0;margin-bottom:10px;">
      <div class="card" onclick="readFree('üíï','Upendo wa Kwanza','Alipokuwa akitazama dirisha la treni, akijua kuwa pendwa lake alikuwa amemwacha, Amina alihisi maumivu yanayoumiza zaidi ya jeraha lolote. Alikuwa amempenda kwa miaka mitano, lakini siku hiyo ilikuwa mwisho wa safari yao ya pamoja.\n\nLakini maisha yana njia yake ya ajabu ya kuleta uponyaji. Wiki tatu baadaye, kwenye stendi ya mabasi ya Kariakoo, mkono mwingine ulimgusa begani...')">
        <div c  }
  .card:hover{transform:translateY(-4px);border-color:var(--gold);}
  .card-img{width:100%;height:110px;object-fit:cover;background:linear-gradient(135deg,#0a1e3a,#1a3a5c);}
  .card-img-placeholder{
    width:100%;height:110px;
    display:flex;align-items:center;justify-content:center;
    font-size:2.5rem;
    background:linear-gradient(135deg,var(--blue),#0a2a50);
  }
  .card-body{padding:10px;}
  .card-title{font-family:'Cinzel',serif;font-size:0.78rem;color:var(--gold2);margin-bottom:4px;}
  .card-desc{font-size:0.7rem;color:#8aa;line-height:1.5;}
  .card-lock{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;}

  /* === VIDEO CARD === */
  .video-card .card-img-placeholder{height:120px;font-size:2.8rem;}

  /* === MODAL === */
  .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center;padding:20px;}
  .overlay.open{display:flex;}
  .modal{
    background:var(--darkblue);border:1px solid var(--gold);border-radius:14px;
    max-width:500px;width:100%;padding:28px;position:relative;
    box-shadow:0 0 40px rgba(201,168,76,0.2);animation:fadeIn .3s ease;
    max-height:90vh;overflow-y:auto;
  }
  .modal h2{font-family:'Cinzel Decorative',serif;color:var(--gold);font-size:1.1rem;margin-bottom:16px;}
  .modal-close{position:absolute;top:14px;right:16px;background:none;border:none;color:var(--white);font-size:1.4rem;cursor:pointer;}
  .modal p{font-size:0.85rem;line-height:1.7;color:#aac;margin-bottom:12px;}
  .modal h3{font-family:'Cinzel',serif;color:var(--cyan);margin:16px 0 8px;font-size:0.9rem;}

  /* === PAYMENT === */
  .payment-box{background:rgba(0,180,216,0.07);border:1px solid var(--cyan);border-radius:10px;padding:16px;margin-top:14px;}
  .mpesa-info{display:flex;align-items:center;gap:10px;margin-bottom:14px;}
  .mpesa-badge{background:#00a651;color:#fff;padding:6px 14px;border-radius:6px;font-weight:700;font-size:0.85rem;}
  .mpesa-num{font-family:'Cinzel',serif;font-size:1rem;color:var(--gold);}
  .mpesa-name{font-size:0.75rem;color:#8aa;}
  .price-tag{font-family:'Cinzel',serif;font-size:1.3rem;color:var(--gold2);margin-bottom:12px;}
  .price-tag span{font-size:0.75rem;color:#8aa;}

  .upload-area{border:2px dashed var(--accent);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s;position:relative;}
  .upload-area:hover{border-color:var(--cyan);}
  .upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;}
  .upload-area p{font-size:0.8rem;color:#8aa;margin-top:6px;}
  .upload-preview{max-width:100%;max-height:180px;margin-top:10px;border-radius:6px;display:none;}

  .btn{
    width:100%;padding:12px;background:linear-gradient(135deg,var(--gold),var(--gold2));
    color:#000;border:none;border-radius:8px;font-family:'Cinzel',serif;
    font-size:0.95rem;font-weight:700;cursor:pointer;margin-top:14px;transition:opacity .2s;
  }
  .btn:hover{opacity:0.9;}
  .btn:disabled{opacity:0.4;cursor:not-allowed;}
  .btn-secondary{background:linear-gradient(135deg,var(--accent),#1a4a8a);color:var(--white);}

  /* === CONFIRM STATUS === */
  .status-box{text-align:center;padding:20px;}
  .status-icon{font-size:3rem;margin-bottom:10px;}
  .status-pending{color:var(--gold);}
  .status-success{color:#00e676;}

  /* === CONTENT VIEWER === */
  .content-viewer{background:var(--blue);border-radius:10px;padding:20px;line-height:1.9;color:#cce;font-size:0.88rem;}
  .content-viewer h2{font-family:'Cinzel',serif;color:var(--gold);margin-bottom:14px;}

  /* === SEASON TABS === */
  .season-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
  .season-tab{padding:6px 14px;border:1px solid var(--accent);border-radius:20px;font-size:0.75rem;cursor:pointer;font-family:'Cinzel',serif;transition:all .2s;}
  .season-tab.active,.season-tab:hover{background:var(--gold);color:#000;border-color:var(--gold);}

  /* === RESPONSIVE === */
  @media(max-width:480px){
    .cards{grid-template-columns:repeat(2,1fr);}
    header{flex-direction:column;gap:10px;padding:10px;}
  }

  /* GLOW PULSE */
  @keyframes glowPulse{0%,100%{box-shadow:0 0 8px rgba(0,180,216,0.3)}50%{box-shadow:0 0 20px rgba(0,180,216,0.7)}}
  .card:hover{animation:glowPulse 2s infinite;}

  .divider{border:none;border-top:1px solid var(--accent);margin:24px 0;}
  .tag{display:inline-block;background:rgba(201,168,76,0.15);border:1px solid var(--gold);border-radius:4px;padding:2px 8px;font-size:0.7rem;color:var(--gold);margin:2px;}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#0a1628,#1a3a5c);border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:1.5rem;">üëÅÔ∏è</div>
    <div>
      <div class="logo-text">The Maktaba</div>
      <div class="logo-sub">Library of Unspoken Secrets</div>
    </div>
  </div>
  <nav>
    <button class="active" onclick="showPage('home')">üè† Nyumbani</button>
    <button onclick="showPage('stories')">üìñ Hadithi</button>
    <button onclick="showPage('videos')">üé¨ Video</button>
    <button onclick="showPage('secrets')">üîê Siri Nyeti</button>
    <button onclick="showPage('my')">üë§ Yangu</button>
  </nav>
</header>

<!-- HOME PAGE -->
<section id="home" class="page active">
  <div class="hero">
    <h1>The Maktaba</h1>
    <p>Library of Unspoken Secrets</p>
    <div class="hero-desc">
      Karibu kwenye maktaba ya siri na hadithi za kipekee. Soma hadithi za mapenzi, simulizi za kusisimua, na fungua siri nyeti za dunia ambazo hazikusikiwa mahali pengine.
    </div>
  </div>

  <div style="padding:16px;">
    <!-- FREE INTRO -->
    <div class="section-title">üéÅ Maudhui ya Bure ‚Äì Karibu Ujaribu!</div>
    <div class="cards">
      <div class="card" onclick="openFreeStory('Upendo wa Kwanza','Hadithi ya msichana mdogo aliyependa kijana asiye na moyo wa kweli. Safari ya maumivu na matumaini...')">
        <div class="card-img-placeholder">üíï</div>
        <div class="card-body">
          <div class="card-title">Upendo wa Kwanza <span class="badge-free">BURE</span></div>
          <div class="card-desc">Hadithi ya mapenzi ya kwanza yenye hisia za kweli</div>
        </div>
      </div>
      <div class="card" onclick="openFreeStory('Siri ya Giza','Usiku ule ulikuwa tofauti. Mwanga uliozima, sauti zilizosimama, na mambo ya ajabu yalianza kutokea katika mji wa Dar es Salaam...')">
        <div class="card-img-placeholder">üåë</div>
        <div class="card-body">
          <div class="card-title">Siri ya Giza <span class="badge-free">BURE</span></div>
          <div class="card-desc">Hadithi ya kusisimua ya usiku wa giza</div>
        </div>
      </div>
      <div class="card" onclick="openFreeVideo()">
        <div class="card-img-placeholder">‚ñ∂Ô∏è</div>
        <div class="card-body">
          <div class="card-title">Intro Video <span class="badge-free">BURE</span></div>
          <div class="card-desc">Tazama video ya utangulizi wa maktaba</div>
        </div>
      </div>
    </div>

    <hr class="divider">

    <!-- PREMIUM PREVIEW -->
    <div class="section-title">‚≠ê Maudhui ya Premium</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;margin-bottom:20px;">
      <div style="background:var(--glass);border:1px solid var(--gold);border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">üíå</div>
        <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:0.8rem;">Hadithi za Mapenzi</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">5,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 5,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('mapenzi')">Jiunge Sasa</button>
      </div>
      <div style="background:var(--glass);border:1px solid var(--cyan);border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">‚ö°</div>
        <div style="font-family:'Cinzel',serif;color:var(--cyan);font-size:0.8rem;">Hadithi Kusisimua</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">5,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 5,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('kusisimua')">Jiunge Sasa</button>
      </div>
      <div style="background:var(--glass);border:1px solid #8a2be2;border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">üåê</div>
        <div style="font-family:'Cinzel',serif;color:#b080ff;font-size:0.8rem;">Siri Nyeti</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">10,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 10,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('siri')">Jiunge Sasa</button>
      </div>
    </div>

    <div style="background:linear-gradient(135deg,rgba(201,168,76,0.1),rgba(0,180,216,0.1));border:1px solid var(--gold);border-radius:12px;padding:16px;text-align:center;">
      <div style="font-family:'Cinzel Decorative',serif;color:var(--gold);font-size:0.9rem;margin-bottom:6px;">üé¨ Video ‚Äì Season Pass</div>
      <div style="color:#aac;font-size:0.82rem;margin-bottom:10px;">Tazama video zote za simulizi za kweli ‚Äì kila Season ina video 10,000+</div>
      <div style="color:var(--gold2);font-family:'Cinzel',serif;font-size:1.1rem;margin-bottom:10px;">TZS 10,000 / Season</div>
      <button class="btn" style="max-width:260px;" onclick="openPayment('video')">üé¨ Nunua Season Pass</button>
    </div>
  </div>
</section>

<!-- STORIES PAGE -->
<section id="stories" class="page">
  <div style="padding:16px;">
    <div class="section-title">üíå Hadithi za Mapenzi</div>
    <div class="cards" id="love-cards"></div>
    <hr class="divider">
    <div class="section-title">‚ö° Hadithi za Kusisimua</div>
    <div class="cards" id="thriller-cards"></div>
  </div>
</section>

<!-- VIDEOS PAGE -->
<section id="videos" class="page">
  <div style="padding:16px;">
    <div class="season-tabs">
      <div class="season-tab active">Season 1</div>
      <div class="season-tab">Season 2</div>
      <div class="season-tab">Season 3</div>
      <div class="season-tab">Season 4+</div>
    </div>
    <div class="section-title">üé¨ Video za Simulizi</div>
    <div class="cards" id="video-cards"></div>
  </div>
</section>

<!-- SECRETS PAGE -->
<section id="secrets" class="page">
  <div style="padding:16px;">
    <div class="section-title">üîê Siri Nyeti za Dunia</div>
    <div style="background:rgba(138,43,226,0.1);border:1px solid #8a2be2;border-radius:10px;padding:14px;margin-bottom:16px;font-size:0.82rem;color:#c0a0ff;">
      ‚ö†Ô∏è Maudhui haya yana siri za kina kuhusu historia ya ulimwengu, mifumo ya kimataifa, na ukweli uliofichwa. Kwa watu wazima pekee.
    </div>
    <div class="cards" id="secret-cards"></div>
  </div>
</section>

<!-- MY PAGE -->
<section id="my" class="page">
  <div style="padding:16px;">
    <div style="text-align:center;padding:30px 0;">
      <div style="font-size:3rem;margin-bottom:10px;">üë§</div>
      <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:1rem;" id="user-status-display">Umwanachama wa Kawaida</div>
      <div style="color:#8aa;font-size:0.8rem;margin-top:4px;" id="user-access-display">Unaweza kufikia maudhui ya bure pekee</div>
    </div>
    <div class="section-title">üìã Michango Yangu</div>
    <div id="my-subscriptions">
      <div style="color:#8aa;text-align:center;padding:20px;font-size:0.85rem;">Bado hujalipia maudhui yoyote ya premium</div>
    </div>
    <hr class="divider">
    <div class="section-title">üì§ Lipia Maudhui Mapya</div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <button class="btn" onclick="openPayment('mapenzi')">üíå Hadithi za Mapenzi ‚Äì TZS 5,000</button>
      <button class="btn btn-secondary" onclick="openPayment('kusisimua')">‚ö° Hadithi Kusisimua ‚Äì TZS 5,000</button>
      <button class="btn btn-secondary" onclick="openPayment('siri')">üîê Siri Nyeti ‚Äì TZS 10,000</button>
      <button class="btn btn-secondary" onclick="openPayment('video')">üé¨ Video Season Pass ‚Äì TZS 10,000</button>
    </div>
  </div>
</section>

<!-- ======= MODALS ======= -->
<!-- PAYMENT MODAL -->
<div class="overlay" id="payment-overlay">
  <div class="modal">
    <button class="modal-close" onclick="closePayment()">‚úï</button>
    <h2 id="payment-title">Malipo ya Maudhui</h2>

    <div class="payment-box">
      <div style="font-family:'Cinzel',serif;color:var(--cyan);font-size:0.8rem;margin-bottom:10px;">üì± Lipa kwa M-PESA Tanzania</div>
      <div class="mpesa-info">
        <div class="mpesa-badge">M-PESA</div>
        <div>
          <div class="mpesa-num">0763003750</div>
          <div class="mpesa-name">Jina: Faustine Faustine</div>
        </div>
      </div>
      <div class="price-tag" id="payment-price">TZS 5,000 <span>/ mwezi</span></div>
      <div style="font-size:0.8rem;color:#8aa;margin-bottom:14px;line-height:1.6;">
        1. Fungua M-PESA kwenye simu yako<br>
        2. Chagua <strong style="color:var(--white);">Lipa Bili / Send Money</strong><br>
        3. Weka namba: <strong style="color:var(--gold);">0763003750</strong><br>
        4. Weka kiasi kinachohusika<br>
        5. Thibitisha na pin yako<br>
        6. Piga picha (screenshot) ya muamala uliothibitishwa
      </div>
    </div>

    <h3>üì∏ Pakia Screenshot ya Malipo</h3>
    <div class="upload-area" id="upload-area">
      <input type="file" accept="image/*" onchange="handleScreenshot(event)">
      <div style="font-size:2rem;">üì§</div>
      <p>Bonyeza hapa kupakia picha ya muamala wako wa M-PESA</p>
      <img class="upload-preview" id="preview-img">
    </div>

    <div id="confirm-status" style="display:none;">
      <div class="status-box status-pending">
        <div class="status-icon">‚è≥</div>
        <div style="font-family:'Cinzel',serif;color:var(--gold);">Inathibitishwa...</div>
        <div style="font-size:0.8rem;color:#8aa;margin-top:6px;">Tafadhali subiri sekunde chache</div>
      </div>
    </div>

    <div id="confirm-success" style="display:none;">
      <div class="status-box">
        <div class="status-icon">‚úÖ</div>
        <div style="font-family:'Cinzel',serif;color:#00e676;">Malipo Yamethibitishwa!</div>
        <div style="font-size:0.82rem;color:#aac;margin-top:8px;">Hongera! Sasa una ufikiaji wa maudhui yaliyolipwa.</div>
        <button class="btn" style="margin-top:16px;" onclick="closeAndUnlock()">üöÄ Fikia Maudhui Sasa</button>
      </div>
    </div>

    <button class="btn" id="confirm-btn" style="display:none;" onclick="confirmPayment()">‚úÖ Thibitisha Malipo</button>
  </div>
</div>

<!-- STORY MODAL -->
<div class="overlay" id="story-overlay">
  <div class="modal" style="max-width:600px;">
    <button class="modal-close" onclick="closeStory()">‚úï</button>
    <div class="content-viewer">
      <h2 id="story-title"></h2>
      <div id="story-content"></div>
    </div>
  </div>
</div>

<!-- VIDEO MODAL -->
<div class="overlay" id="video-overlay">
  <div class="modal">
    <button class="modal-close" onclick="document.getElementById('video-overlay').classList.remove('open')">‚úï</button>
    <h2>üé¨ Video ya Utangulizi ‚Äì Bure</h2>
    <div style="background:var(--blue);border-radius:10px;padding:30px;text-align:center;">
      <div style="font-size:4rem;margin-bottom:16px;">‚ñ∂Ô∏è</div>
      <div style="font-family:'Cinzel',serif;color:var(--gold);margin-bottom:8px;">Karibu The Maktaba</div>
      <div style="font-size:0.82rem;color:#aac;line-height:1.7;">
        The Maktaba ni maktaba ya kipekee inayotoa hadithi za kipekee, simulizi za kweli, na siri nyeti ambazo hazitapatikana mahali pengine. Jiunge nasi na ugundue ulimwengu uliofichwa...
      </div>
      <div style="margin-top:16px;padding:14px;background:rgba(0,0,0,0.3);border-radius:8px;color:#8aa;font-size:0.78rem;">
        üìπ Video ya kweli itaonekana hapa baada ya kupakia maudhui
      </div>
    </div>
  </div>
</div>

<!-- LOCKED MODAL -->
<div class="overlay" id="locked-overlay">
  <div class="modal" style="text-align:center;">
    <button class="modal-close" onclick="document.getElementById('locked-overlay').classList.remove('open')">‚úï</button>
    <div style="font-size:3rem;margin-bottom:14px;">üîê</div>
    <h2>Maudhui Yamefungwa</h2>
    <p>Maudhui haya yanahitaji usajili wa premium. Lipia na M-PESA kupata ufikiaji wa haraka.</p>
    <button class="btn" id="locked-pay-btn" onclick="openPaymentFromLocked()">üí≥ Lipia Sasa</button>
  </div>
</div>

<script>
// === STATE ===
const access = {mapenzi:false, kusisimua:false, siri:false, video:false};
let currentPaymentType = '';
let screenshotUploaded = false;

// === DATA ===
const loveStories = [
  {title:'Moyo Uliotiwa Mbali',desc:'Upendo uliokua katika umbali',icon:'üíï',free:true,content:'Alipokuwa akitazama dirisha la treni, akijua kuwa pendwa lake alikuwa amemwacha, Amina alihisi maumivu yanayoumiza zaidi ya jeraha lolote la mwili. Lakini maisha yana njia yake ya ajabu ya kuleta uponyaji...'},
  {title:'Siri ya Moyo',desc:'Upendo uliofichwa kwa miaka kumi',icon:'ü§´',free:false},
  {title:'Barua za Usiku',desc:'Barua za upendo zilizoandikwa gizani',icon:'‚úâÔ∏è',free:false},
  {title:'Mpenzi wa Ndoto',desc:'Ndoto iliyokuwa ukweli',icon:'üåô',free:false},
  {title:'Vita vya Moyo',desc:'Upendo dhidi ya familia',icon:'‚öîÔ∏è',free:false},
  {title:'Kurudi Tena',desc:'Mkutano baada ya miaka 15',icon:'üîÑ',free:false},
];
const thrillerStories = [
  {title:'Nyumba ya Giza',desc:'Siri iliyofichwa ndani ya nyumba ya zamani',icon:'üèöÔ∏è',free:true,content:'Kila usiku, mlango wa basement ulifunguka peke yake. Hassan aliamua uchunguze ukweli wa nyumba hiyo ya miaka mia moja, lakini hakujua alikuwa anaingia katika mtego wa hatari...'},
  {title:'Mkurupuzo wa Usiku',desc:'Mauaji ya kipekee katika jiji',icon:'üî™',free:false},
  {title:'Kivuli Kinachofuata',desc:'Kitu kinachomfuata kila mahali',icon:'üë§',free:false},
  {title:'Msalaba wa Damu',desc:'Hadithi ya mauaji ya kidini',icon:'‚õ™',free:false},
  {title:'Mtego wa Serikali',desc:'Operesheni ya siri iliyofichwa',icon:'üïµÔ∏è',free:false},
  {title:'Kutoweka kwa Daktari',desc:'Daktari maarufu aliyepotea usiku mmoja',icon:'ü©∫',free:false},
];
const secretData = [
  {title:'Illuminati ‚Äì Ukweli',desc:'Kikundi hiki kwa kweli kipo?',icon:'üëÅÔ∏è',free:false},
  {title:'Siri za Serikali za Afrika',desc:'Mambo yasiyosemwa hadharani',icon:'üåç',free:false},
  {title:'Mfumo wa Fedha Duniani',desc:'Nani anamiliki uchumi wa dunia?',icon:'üí∞',free:false},
  {title:'Teknolojia Zilizofichwa',desc:'Uvumbuzi ambao haujafika kwa watu',icon:'üî¨',free:false},
  {title:'Historia Iliyobadilishwa',desc:'Mambo waliyofuta kwenye vitabu',icon:'üìö',free:false},
  {title:'Siri za Anga la Juu',desc:'Extraterrestrials ‚Äì ukweli wa NASA',icon:'üõ∏',free:false},
];
const videoData = [
  {title:'Intro: Karibu Maktaba',desc:'Video ya kwanza ya bure',icon:'üé≠',free:true},
  {title:'Simulizi: Mama Aliyepigana',desc:'Hadithi ya kweli ya nguvu za mama',icon:'üë©',free:false,season:1},
  {title:'Uhalifu wa Watu Maarufu',desc:'Mambo wanayofanya nyuma ya pazia',icon:'üé≠',free:false,season:1},
  {title:'Mfumo wa Udanganyifu',desc:'Jinsi unavyodanganywa kila siku',icon:'üé™',free:false,season:1},
  {title:'Siri za Ndoa',desc:'Mambo ambayo wenzi hawasemi',icon:'üíç',free:false,season:1},
  {title:'Nguvu za Akili',desc:'Jinsi ya kudhibiti mawazo yako',icon:'üß†',free:false,season:2},
];

function renderCards(containerId, data, type) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = data.map(item => `
    <div class="card ${type === 'video' ? 'video-card' : ''}" onclick="openContent('${type}','${item.title}',${item.free ? 'true' : 'false'},'${(item.content||'').replace(/'/g,"\\'")}')">
      <div class="card-img-placeholder">${item.icon}</div>
      <div class="card-body">
        <div class="card-title">${item.title} ${item.free ? '<span class="badge-free">BURE</span>' : '<span class="badge-locked">PREMIUM</span>'}</div>
        <div class="card-desc">${item.desc}</div>
      </div>
      ${!item.free ? '<div class="card-lock">üîí</div>' : ''}
    </div>
  `).join('');
}

function initCards() {
  renderCards('love-cards', loveStories, 'mapenzi');
  renderCards('thriller-cards', thrillerStories, 'kusisimua');
  renderCards('secret-cards', secretData, 'siri');
  renderCards('video-cards', videoData, 'video');
}

// === NAVIGATION ===
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
}

// === CONTENT OPEN ===
function openContent(type, title, isFree, content) {
  if (isFree) {
    if (type === 'video') { openFreeVideo(); return; }
    openFreeStory(title, content);
    return;
  }
  if (access[type]) {
    openFreeStory(title, 'Maudhui kamili yanapatikana kwa wanachama waliosajiliwa. Hii ni sehemu ya kwanza:\n\n' + (content || 'Maudhui haya yako katika hifadhidata yetu ya premium. Endelea kusoma bila kikwazo chochote...'));
    return;
  }
  currentPaymentType = type;
  document.getElementById('locked-overlay').classList.add('open');
}

function openFreeStory(title, content) {
  document.getElementById('story-title').textContent = title;
  document.getElementById('story-content').innerHTML = content.replace(/\n/g,'<br>');
  document.getElementById('story-overlay').classList.add('open');
}

function closeStory() {
  document.getElementById('story-overlay').classList.remove('open');
}

function openFreeVideo() {
  document.getElementById('video-overlay').classList.add('open');
}

// === PAYMENT ===
const paymentInfo = {
  mapenzi: {title:'üíå Hadithi za Mapenzi ‚Äì Premium', price:'TZS 5,000 <span>/ mwezi</span>'},
  kusisimua: {title:'‚ö° Hadithi za Kusisimua ‚Äì Premium', price:'TZS 5,000 <span>/ mwezi</span>'},
  siri: {title:'üîê Siri Nyeti za Dunia ‚Äì Premium', price:'TZS 10,000 <span>/ mwezi</span>'},
  video: {title:'üé¨ Video Season Pass ‚Äì Premium', price:'TZS 10,000 <span>/ Season</span>'},
};

function openPayment(type) {
  currentPaymentType = type;
  const info = paymentInfo[type];
  document.getElementById('payment-title').textContent = info.title;
  document.getElementById('payment-price').innerHTML = info.price;
  document.getElementById('confirm-status').style.display = 'none';
  document.getElementById('confirm-success').style.display = 'none';
  document.getElementById('confirm-btn').style.display = 'none';
  document.getElementById('upload-area').querySelector('p').textContent = 'Bonyeza hapa kupakia picha ya muamala wako wa M-PESA';
  document.getElementById('preview-img').style.display = 'none';
  document.getElementById('preview-img').src = '';
  screenshotUploaded = false;
  document.getElementById('payment-overlay').classList.add('open');
  document.getElementById('locked-overlay').classList.remove('open');
}

function openPaymentFromLocked() {
  openPayment(currentPaymentType || 'mapenzi');
}

function closePayment() {
  document.getElementById('payment-overlay').classList.remove('open');
}

function handleScreenshot(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = document.getElementById('preview-img');
    img.src = ev.target.result;
    img.style.display = 'block';
    document.getElementById('upload-area').querySelector('p').textContent = '‚úÖ Picha imepakiwa! Bonyeza thibitisha hapa chini.';
    document.getElementById('confirm-btn').style.display = 'block';
    screenshotUploaded = true;
  };
  reader.readAsDataURL(file);
}

function confirmPayment() {
  if (!screenshotUploaded) return;
  document.getElementById('confirm-btn').style.display = 'none';
  document.getElementById('upload-area').style.display = 'none';
  document.getElementById('confirm-status').style.display = 'block';

  setTimeout(() => {
    document.getElementById('confirm-status').style.display = 'none';
    document.getElementById('confirm-success').style.display = 'block';
    // Grant access
    access[currentPaymentType] = true;
    updateUserPage();
  }, 3000);
}

function closeAndUnlock() {
  document.getElementById('payment-overlay').classList.remove('open');
  document.getElementById('upload-area').style.display = 'flex';
  // Go to relevant page
  const map = {mapenzi:'stories',kusisimua:'stories',siri:'secrets',video:'videos'};
  const targetPage = map[currentPaymentType] || 'home';
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(targetPage).classList.add('active');
}

function updateUserPage() {
  const unlocked = Object.entries(access).filter(([k,v]) => v).map(([k]) => k);
  const labels = {mapenzi:'üíå Hadithi za Mapenzi',kusisimua:'‚ö° Hadithi Kusisimua',siri:'üîê Siri Nyeti',video:'üé¨ Video Season'};
  const div = document.getElementById('my-subscriptions');
  if (unlocked.length === 0) {
    div.innerHTML = '<div style="color:#8aa;text-align:center;padding:20px;font-size:0.85rem;">Bado hujalipia maudhui yoyote ya premium</div>';
    document.getElementById('user-status-display').textContent = 'Mwanachama wa Kawaida';
    document.getElementById('user-access-display').textContent = 'Unaweza kufikia maudhui ya bure pekee';
  } else {
    document.getElementById('user-status-display').textContent = 'Mwanachama wa Premium ‚≠ê';
    document.getElementById('user-access-display').textContent = 'Una ufikiaji wa: ' + unlocked.map(k => labels[k]).join(', ');
    div.innerHTML = unlocked.map(k => `
      <div style="background:var(--glass);border:1px solid var(--gold);border-radius:8px;padding:12px;margin-bottom:10px;display:flex;align-items:center;gap:10px;">
        <span style="font-size:1.5rem;">${labels[k].split(' ')[0]}</span>
        <div>
          <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:0.85rem;">${labels[k]}</div>
          <div style="font-size:0.72rem;color:#0f0;margin-top:2px;">‚úÖ Imeamilishwa</div>
        </div>
      </div>
    `).join('');
  }
}

// Season tabs
document.querySelectorAll('.season-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.season-tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
  });
});

// Init
initCards();
</script>
</body>
</html>
