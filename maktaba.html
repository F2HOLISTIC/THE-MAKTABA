<!DOCTYPE html>
<html lang="sw">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Maktaba â€“ Library of Unspoken Secrets</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --dark: #050a14;
    --darkblue: #0a1628;
    --blue: #0d2244;
    --accent: #0e4a7a;
    --cyan: #00b4d8;
    --gold: #c9a84c;
    --gold2: #f0c040;
    --white: #e8eaf0;
    --glass: rgba(13,34,68,0.6);
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--dark);color:var(--white);font-family:'Lato',sans-serif;min-height:100vh;overflow-x:hidden;}

  /* === HEADER === */
  header{
    background:linear-gradient(180deg,#000a1a 0%,var(--darkblue) 100%);
    border-bottom:1px solid var(--gold);
    padding:12px 20px;
    display:flex;align-items:center;justify-content:space-between;
    position:sticky;top:0;z-index:100;
  }
  .logo{display:flex;align-items:center;gap:10px;}
  .logo img{width:48px;height:48px;border-radius:50%;}
  .logo-text{font-family:'Cinzel Decorative',serif;font-size:1rem;color:var(--gold);line-height:1.2;}
  .logo-sub{font-family:'Cinzel',serif;font-size:0.55rem;color:var(--cyan);letter-spacing:2px;}
  nav{display:flex;gap:6px;flex-wrap:wrap;}
  nav button{background:none;border:1px solid var(--accent);color:var(--white);padding:6px 12px;border-radius:4px;cursor:pointer;font-size:0.75rem;font-family:'Cinzel',serif;transition:all .2s;}
  nav button:hover,nav button.active{background:var(--gold);color:#000;border-color:var(--gold);}

  /* === HERO === */
  .hero{
    background:linear-gradient(135deg,var(--dark) 0%,var(--blue) 50%,var(--dark) 100%);
    text-align:center;padding:60px 20px 40px;position:relative;overflow:hidden;
  }
  .hero::before{
    content:'';position:absolute;inset:0;
    background:radial-gradient(ellipse at 50% 60%,rgba(0,180,216,0.08) 0%,transparent 70%);
  }
  .hero h1{font-family:'Cinzel Decorative',serif;font-size:clamp(1.6rem,5vw,2.8rem);color:var(--gold);text-shadow:0 0 30px rgba(201,168,76,0.5);}
  .hero p{font-family:'Cinzel',serif;color:var(--cyan);font-size:0.9rem;margin-top:8px;letter-spacing:3px;}
  .hero-desc{max-width:560px;margin:20px auto 0;color:#8aa;font-size:0.88rem;line-height:1.7;}

  /* === SECTIONS === */
  section.page{display:none;padding:20px;}
  section.page.active{display:block;animation:fadeIn .4s ease;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

  /* === GRID === */
  .section-title{font-family:'Cinzel',serif;color:var(--gold);font-size:1.1rem;margin:20px 0 14px;border-left:3px solid var(--cyan);padding-left:10px;}
  .badge-free{background:var(--cyan);color:#000;font-size:0.65rem;padding:2px 7px;border-radius:20px;font-weight:700;margin-left:8px;}
  .badge-locked{background:var(--gold);color:#000;font-size:0.65rem;padding:2px 7px;border-radius:20px;font-weight:700;margin-left:8px;}

  .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;}
  .card{
    background:var(--glass);border:1px solid var(--accent);border-radius:10px;
    overflow:hidden;cursor:pointer;transition:transform .2s,border-color .2s;position:relative;
  }
  .card:hover{transform:translateY(-4px);border-color:var(--gold);}
  .card-img{width:100%;height:110px;object-fit:cover;background:linear-gradient(135deg,#0a1e3a,#1a3a5c);}
  .card-img-placeholder{
    width:100%;height:110px;
    display:flex;align-items:center;justify-content:center;
    font-size:2.5rem;
    background:linear-gradient(135deg,var(--blue),#0a2a50);
  }
  .card-body{padding:10px;}
  .card-title{font-family:'Cinzel',serif;font-size:0.78rem;color:var(--gold2);margin-bottom:4px;}
  .card-desc{font-size:0.7rem;color:#8aa;line-height:1.5;}
  .card-lock{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;}

  /* === VIDEO CARD === */
  .video-card .card-img-placeholder{height:120px;font-size:2.8rem;}

  /* === MODAL === */
  .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center;padding:20px;}
  .overlay.open{display:flex;}
  .modal{
    background:var(--darkblue);border:1px solid var(--gold);border-radius:14px;
    max-width:500px;width:100%;padding:28px;position:relative;
    box-shadow:0 0 40px rgba(201,168,76,0.2);animation:fadeIn .3s ease;
    max-height:90vh;overflow-y:auto;
  }
  .modal h2{font-family:'Cinzel Decorative',serif;color:var(--gold);font-size:1.1rem;margin-bottom:16px;}
  .modal-close{position:absolute;top:14px;right:16px;background:none;border:none;color:var(--white);font-size:1.4rem;cursor:pointer;}
  .modal p{font-size:0.85rem;line-height:1.7;color:#aac;margin-bottom:12px;}
  .modal h3{font-family:'Cinzel',serif;color:var(--cyan);margin:16px 0 8px;font-size:0.9rem;}

  /* === PAYMENT === */
  .payment-box{background:rgba(0,180,216,0.07);border:1px solid var(--cyan);border-radius:10px;padding:16px;margin-top:14px;}
  .mpesa-info{display:flex;align-items:center;gap:10px;margin-bottom:14px;}
  .mpesa-badge{background:#00a651;color:#fff;padding:6px 14px;border-radius:6px;font-weight:700;font-size:0.85rem;}
  .mpesa-num{font-family:'Cinzel',serif;font-size:1rem;color:var(--gold);}
  .mpesa-name{font-size:0.75rem;color:#8aa;}
  .price-tag{font-family:'Cinzel',serif;font-size:1.3rem;color:var(--gold2);margin-bottom:12px;}
  .price-tag span{font-size:0.75rem;color:#8aa;}

  .upload-area{border:2px dashed var(--accent);border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s;position:relative;}
  .upload-area:hover{border-color:var(--cyan);}
  .upload-area input{position:absolute;inset:0;opacity:0;cursor:pointer;}
  .upload-area p{font-size:0.8rem;color:#8aa;margin-top:6px;}
  .upload-preview{max-width:100%;max-height:180px;margin-top:10px;border-radius:6px;display:none;}

  .btn{
    width:100%;padding:12px;background:linear-gradient(135deg,var(--gold),var(--gold2));
    color:#000;border:none;border-radius:8px;font-family:'Cinzel',serif;
    font-size:0.95rem;font-weight:700;cursor:pointer;margin-top:14px;transition:opacity .2s;
  }
  .btn:hover{opacity:0.9;}
  .btn:disabled{opacity:0.4;cursor:not-allowed;}
  .btn-secondary{background:linear-gradient(135deg,var(--accent),#1a4a8a);color:var(--white);}

  /* === CONFIRM STATUS === */
  .status-box{text-align:center;padding:20px;}
  .status-icon{font-size:3rem;margin-bottom:10px;}
  .status-pending{color:var(--gold);}
  .status-success{color:#00e676;}

  /* === CONTENT VIEWER === */
  .content-viewer{background:var(--blue);border-radius:10px;padding:20px;line-height:1.9;color:#cce;font-size:0.88rem;}
  .content-viewer h2{font-family:'Cinzel',serif;color:var(--gold);margin-bottom:14px;}

  /* === SEASON TABS === */
  .season-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
  .season-tab{padding:6px 14px;border:1px solid var(--accent);border-radius:20px;font-size:0.75rem;cursor:pointer;font-family:'Cinzel',serif;transition:all .2s;}
  .season-tab.active,.season-tab:hover{background:var(--gold);color:#000;border-color:var(--gold);}

  /* === RESPONSIVE === */
  @media(max-width:480px){
    .cards{grid-template-columns:repeat(2,1fr);}
    header{flex-direction:column;gap:10px;padding:10px;}
  }

  /* GLOW PULSE */
  @keyframes glowPulse{0%,100%{box-shadow:0 0 8px rgba(0,180,216,0.3)}50%{box-shadow:0 0 20px rgba(0,180,216,0.7)}}
  .card:hover{animation:glowPulse 2s infinite;}

  .divider{border:none;border-top:1px solid var(--accent);margin:24px 0;}
  .tag{display:inline-block;background:rgba(201,168,76,0.15);border:1px solid var(--gold);border-radius:4px;padding:2px 8px;font-size:0.7rem;color:var(--gold);margin:2px;}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div style="width:48px;height:48px;border-radius:50%;background:linear-gradient(135deg,#0a1628,#1a3a5c);border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:1.5rem;">ğŸ‘ï¸</div>
    <div>
      <div class="logo-text">The Maktaba</div>
      <div class="logo-sub">Library of Unspoken Secrets</div>
    </div>
  </div>
  <nav>
    <button class="active" onclick="showPage('home')">ğŸ  Nyumbani</button>
    <button onclick="showPage('stories')">ğŸ“– Hadithi</button>
    <button onclick="showPage('videos')">ğŸ¬ Video</button>
    <button onclick="showPage('secrets')">ğŸ” Siri Nyeti</button>
    <button onclick="showPage('my')">ğŸ‘¤ Yangu</button>
  </nav>
</header>

<!-- HOME PAGE -->
<section id="home" class="page active">
  <div class="hero">
    <h1>The Maktaba</h1>
    <p>Library of Unspoken Secrets</p>
    <div class="hero-desc">
      Karibu kwenye maktaba ya siri na hadithi za kipekee. Soma hadithi za mapenzi, simulizi za kusisimua, na fungua siri nyeti za dunia ambazo hazikusikiwa mahali pengine.
    </div>
  </div>

  <div style="padding:16px;">
    <!-- FREE INTRO -->
    <div class="section-title">ğŸ Maudhui ya Bure â€“ Karibu Ujaribu!</div>
    <div class="cards">
      <div class="card" onclick="openFreeStory('Upendo wa Kwanza','Hadithi ya msichana mdogo aliyependa kijana asiye na moyo wa kweli. Safari ya maumivu na matumaini...')">
        <div class="card-img-placeholder">ğŸ’•</div>
        <div class="card-body">
          <div class="card-title">Upendo wa Kwanza <span class="badge-free">BURE</span></div>
          <div class="card-desc">Hadithi ya mapenzi ya kwanza yenye hisia za kweli</div>
        </div>
      </div>
      <div class="card" onclick="openFreeStory('Siri ya Giza','Usiku ule ulikuwa tofauti. Mwanga uliozima, sauti zilizosimama, na mambo ya ajabu yalianza kutokea katika mji wa Dar es Salaam...')">
        <div class="card-img-placeholder">ğŸŒ‘</div>
        <div class="card-body">
          <div class="card-title">Siri ya Giza <span class="badge-free">BURE</span></div>
          <div class="card-desc">Hadithi ya kusisimua ya usiku wa giza</div>
        </div>
      </div>
      <div class="card" onclick="openFreeVideo()">
        <div class="card-img-placeholder">â–¶ï¸</div>
        <div class="card-body">
          <div class="card-title">Intro Video <span class="badge-free">BURE</span></div>
          <div class="card-desc">Tazama video ya utangulizi wa maktaba</div>
        </div>
      </div>
    </div>

    <hr class="divider">

    <!-- PREMIUM PREVIEW -->
    <div class="section-title">â­ Maudhui ya Premium</div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;text-align:center;margin-bottom:20px;">
      <div style="background:var(--glass);border:1px solid var(--gold);border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">ğŸ’Œ</div>
        <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:0.8rem;">Hadithi za Mapenzi</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">5,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 5,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('mapenzi')">Jiunge Sasa</button>
      </div>
      <div style="background:var(--glass);border:1px solid var(--cyan);border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">âš¡</div>
        <div style="font-family:'Cinzel',serif;color:var(--cyan);font-size:0.8rem;">Hadithi Kusisimua</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">5,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 5,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('kusisimua')">Jiunge Sasa</button>
      </div>
      <div style="background:var(--glass);border:1px solid #8a2be2;border-radius:10px;padding:16px;">
        <div style="font-size:1.8rem;margin-bottom:6px;">ğŸŒ</div>
        <div style="font-family:'Cinzel',serif;color:#b080ff;font-size:0.8rem;">Siri Nyeti</div>
        <div style="color:var(--cyan);font-size:1.2rem;margin:4px 0;">10,000+</div>
        <div style="font-size:0.7rem;color:#8aa;">TZS 10,000/mwezi</div>
        <button class="btn btn-secondary" style="margin-top:8px;font-size:0.7rem;padding:7px;" onclick="openPayment('siri')">Jiunge Sasa</button>
      </div>
    </div>

    <div style="background:linear-gradient(135deg,rgba(201,168,76,0.1),rgba(0,180,216,0.1));border:1px solid var(--gold);border-radius:12px;padding:16px;text-align:center;">
      <div style="font-family:'Cinzel Decorative',serif;color:var(--gold);font-size:0.9rem;margin-bottom:6px;">ğŸ¬ Video â€“ Season Pass</div>
      <div style="color:#aac;font-size:0.82rem;margin-bottom:10px;">Tazama video zote za simulizi za kweli â€“ kila Season ina video 10,000+</div>
      <div style="color:var(--gold2);font-family:'Cinzel',serif;font-size:1.1rem;margin-bottom:10px;">TZS 10,000 / Season</div>
      <button class="btn" style="max-width:260px;" onclick="openPayment('video')">ğŸ¬ Nunua Season Pass</button>
    </div>
  </div>
</section>

<!-- STORIES PAGE -->
<section id="stories" class="page">
  <div style="padding:16px;">
    <div class="section-title">ğŸ’Œ Hadithi za Mapenzi</div>
    <div class="cards" id="love-cards"></div>
    <hr class="divider">
    <div class="section-title">âš¡ Hadithi za Kusisimua</div>
    <div class="cards" id="thriller-cards"></div>
  </div>
</section>

<!-- VIDEOS PAGE -->
<section id="videos" class="page">
  <div style="padding:16px;">
    <div class="season-tabs">
      <div class="season-tab active">Season 1</div>
      <div class="season-tab">Season 2</div>
      <div class="season-tab">Season 3</div>
      <div class="season-tab">Season 4+</div>
    </div>
    <div class="section-title">ğŸ¬ Video za Simulizi</div>
    <div class="cards" id="video-cards"></div>
  </div>
</section>

<!-- SECRETS PAGE -->
<section id="secrets" class="page">
  <div style="padding:16px;">
    <div class="section-title">ğŸ” Siri Nyeti za Dunia</div>
    <div style="background:rgba(138,43,226,0.1);border:1px solid #8a2be2;border-radius:10px;padding:14px;margin-bottom:16px;font-size:0.82rem;color:#c0a0ff;">
      âš ï¸ Maudhui haya yana siri za kina kuhusu historia ya ulimwengu, mifumo ya kimataifa, na ukweli uliofichwa. Kwa watu wazima pekee.
    </div>
    <div class="cards" id="secret-cards"></div>
  </div>
</section>

<!-- MY PAGE -->
<section id="my" class="page">
  <div style="padding:16px;">
    <div style="text-align:center;padding:30px 0;">
      <div style="font-size:3rem;margin-bottom:10px;">ğŸ‘¤</div>
      <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:1rem;" id="user-status-display">Umwanachama wa Kawaida</div>
      <div style="color:#8aa;font-size:0.8rem;margin-top:4px;" id="user-access-display">Unaweza kufikia maudhui ya bure pekee</div>
    </div>
    <div class="section-title">ğŸ“‹ Michango Yangu</div>
    <div id="my-subscriptions">
      <div style="color:#8aa;text-align:center;padding:20px;font-size:0.85rem;">Bado hujalipia maudhui yoyote ya premium</div>
    </div>
    <hr class="divider">
    <div class="section-title">ğŸ“¤ Lipia Maudhui Mapya</div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <button class="btn" onclick="openPayment('mapenzi')">ğŸ’Œ Hadithi za Mapenzi â€“ TZS 5,000</button>
      <button class="btn btn-secondary" onclick="openPayment('kusisimua')">âš¡ Hadithi Kusisimua â€“ TZS 5,000</button>
      <button class="btn btn-secondary" onclick="openPayment('siri')">ğŸ” Siri Nyeti â€“ TZS 10,000</button>
      <button class="btn btn-secondary" onclick="openPayment('video')">ğŸ¬ Video Season Pass â€“ TZS 10,000</button>
    </div>
  </div>
</section>

<!-- ======= MODALS ======= -->
<!-- PAYMENT MODAL -->
<div class="overlay" id="payment-overlay">
  <div class="modal">
    <button class="modal-close" onclick="closePayment()">âœ•</button>
    <h2 id="payment-title">Malipo ya Maudhui</h2>

    <div class="payment-box">
      <div style="font-family:'Cinzel',serif;color:var(--cyan);font-size:0.8rem;margin-bottom:10px;">ğŸ“± Lipa kwa M-PESA Tanzania</div>
      <div class="mpesa-info">
        <div class="mpesa-badge">M-PESA</div>
        <div>
          <div class="mpesa-num">0763003750</div>
          <div class="mpesa-name">Jina: Faustine Faustine</div>
        </div>
      </div>
      <div class="price-tag" id="payment-price">TZS 5,000 <span>/ mwezi</span></div>
      <div style="font-size:0.8rem;color:#8aa;margin-bottom:14px;line-height:1.6;">
        1. Fungua M-PESA kwenye simu yako<br>
        2. Chagua <strong style="color:var(--white);">Lipa Bili / Send Money</strong><br>
        3. Weka namba: <strong style="color:var(--gold);">0763003750</strong><br>
        4. Weka kiasi kinachohusika<br>
        5. Thibitisha na pin yako<br>
        6. Piga picha (screenshot) ya muamala uliothibitishwa
      </div>
    </div>

    <h3>ğŸ“¸ Pakia Screenshot ya Malipo</h3>
    <div class="upload-area" id="upload-area">
      <input type="file" accept="image/*" onchange="handleScreenshot(event)">
      <div style="font-size:2rem;">ğŸ“¤</div>
      <p>Bonyeza hapa kupakia picha ya muamala wako wa M-PESA</p>
      <img class="upload-preview" id="preview-img">
    </div>

    <div id="confirm-status" style="display:none;">
      <div class="status-box status-pending">
        <div class="status-icon">â³</div>
        <div style="font-family:'Cinzel',serif;color:var(--gold);">Inathibitishwa...</div>
        <div style="font-size:0.8rem;color:#8aa;margin-top:6px;">Tafadhali subiri sekunde chache</div>
      </div>
    </div>

    <div id="confirm-success" style="display:none;">
      <div class="status-box">
        <div class="status-icon">âœ…</div>
        <div style="font-family:'Cinzel',serif;color:#00e676;">Malipo Yamethibitishwa!</div>
        <div style="font-size:0.82rem;color:#aac;margin-top:8px;">Hongera! Sasa una ufikiaji wa maudhui yaliyolipwa.</div>
        <button class="btn" style="margin-top:16px;" onclick="closeAndUnlock()">ğŸš€ Fikia Maudhui Sasa</button>
      </div>
    </div>

    <button class="btn" id="confirm-btn" style="display:none;" onclick="confirmPayment()">âœ… Thibitisha Malipo</button>
  </div>
</div>

<!-- STORY MODAL -->
<div class="overlay" id="story-overlay">
  <div class="modal" style="max-width:600px;">
    <button class="modal-close" onclick="closeStory()">âœ•</button>
    <div class="content-viewer">
      <h2 id="story-title"></h2>
      <div id="story-content"></div>
    </div>
  </div>
</div>

<!-- VIDEO MODAL -->
<div class="overlay" id="video-overlay">
  <div class="modal">
    <button class="modal-close" onclick="document.getElementById('video-overlay').classList.remove('open')">âœ•</button>
    <h2>ğŸ¬ Video ya Utangulizi â€“ Bure</h2>
    <div style="background:var(--blue);border-radius:10px;padding:30px;text-align:center;">
      <div style="font-size:4rem;margin-bottom:16px;">â–¶ï¸</div>
      <div style="font-family:'Cinzel',serif;color:var(--gold);margin-bottom:8px;">Karibu The Maktaba</div>
      <div style="font-size:0.82rem;color:#aac;line-height:1.7;">
        The Maktaba ni maktaba ya kipekee inayotoa hadithi za kipekee, simulizi za kweli, na siri nyeti ambazo hazitapatikana mahali pengine. Jiunge nasi na ugundue ulimwengu uliofichwa...
      </div>
      <div style="margin-top:16px;padding:14px;background:rgba(0,0,0,0.3);border-radius:8px;color:#8aa;font-size:0.78rem;">
        ğŸ“¹ Video ya kweli itaonekana hapa baada ya kupakia maudhui
      </div>
    </div>
  </div>
</div>

<!-- LOCKED MODAL -->
<div class="overlay" id="locked-overlay">
  <div class="modal" style="text-align:center;">
    <button class="modal-close" onclick="document.getElementById('locked-overlay').classList.remove('open')">âœ•</button>
    <div style="font-size:3rem;margin-bottom:14px;">ğŸ”</div>
    <h2>Maudhui Yamefungwa</h2>
    <p>Maudhui haya yanahitaji usajili wa premium. Lipia na M-PESA kupata ufikiaji wa haraka.</p>
    <button class="btn" id="locked-pay-btn" onclick="openPaymentFromLocked()">ğŸ’³ Lipia Sasa</button>
  </div>
</div>

<script>
// === STATE ===
const access = {mapenzi:false, kusisimua:false, siri:false, video:false};
let currentPaymentType = '';
let screenshotUploaded = false;

// === DATA ===
const loveStories = [
  {title:'Moyo Uliotiwa Mbali',desc:'Upendo uliokua katika umbali',icon:'ğŸ’•',free:true,content:'Alipokuwa akitazama dirisha la treni, akijua kuwa pendwa lake alikuwa amemwacha, Amina alihisi maumivu yanayoumiza zaidi ya jeraha lolote la mwili. Lakini maisha yana njia yake ya ajabu ya kuleta uponyaji...'},
  {title:'Siri ya Moyo',desc:'Upendo uliofichwa kwa miaka kumi',icon:'ğŸ¤«',free:false},
  {title:'Barua za Usiku',desc:'Barua za upendo zilizoandikwa gizani',icon:'âœ‰ï¸',free:false},
  {title:'Mpenzi wa Ndoto',desc:'Ndoto iliyokuwa ukweli',icon:'ğŸŒ™',free:false},
  {title:'Vita vya Moyo',desc:'Upendo dhidi ya familia',icon:'âš”ï¸',free:false},
  {title:'Kurudi Tena',desc:'Mkutano baada ya miaka 15',icon:'ğŸ”„',free:false},
];
const thrillerStories = [
  {title:'Nyumba ya Giza',desc:'Siri iliyofichwa ndani ya nyumba ya zamani',icon:'ğŸšï¸',free:true,content:'Kila usiku, mlango wa basement ulifunguka peke yake. Hassan aliamua uchunguze ukweli wa nyumba hiyo ya miaka mia moja, lakini hakujua alikuwa anaingia katika mtego wa hatari...'},
  {title:'Mkurupuzo wa Usiku',desc:'Mauaji ya kipekee katika jiji',icon:'ğŸ”ª',free:false},
  {title:'Kivuli Kinachofuata',desc:'Kitu kinachomfuata kila mahali',icon:'ğŸ‘¤',free:false},
  {title:'Msalaba wa Damu',desc:'Hadithi ya mauaji ya kidini',icon:'â›ª',free:false},
  {title:'Mtego wa Serikali',desc:'Operesheni ya siri iliyofichwa',icon:'ğŸ•µï¸',free:false},
  {title:'Kutoweka kwa Daktari',desc:'Daktari maarufu aliyepotea usiku mmoja',icon:'ğŸ©º',free:false},
];
const secretData = [
  {title:'Illuminati â€“ Ukweli',desc:'Kikundi hiki kwa kweli kipo?',icon:'ğŸ‘ï¸',free:false},
  {title:'Siri za Serikali za Afrika',desc:'Mambo yasiyosemwa hadharani',icon:'ğŸŒ',free:false},
  {title:'Mfumo wa Fedha Duniani',desc:'Nani anamiliki uchumi wa dunia?',icon:'ğŸ’°',free:false},
  {title:'Teknolojia Zilizofichwa',desc:'Uvumbuzi ambao haujafika kwa watu',icon:'ğŸ”¬',free:false},
  {title:'Historia Iliyobadilishwa',desc:'Mambo waliyofuta kwenye vitabu',icon:'ğŸ“š',free:false},
  {title:'Siri za Anga la Juu',desc:'Extraterrestrials â€“ ukweli wa NASA',icon:'ğŸ›¸',free:false},
];
const videoData = [
  {title:'Intro: Karibu Maktaba',desc:'Video ya kwanza ya bure',icon:'ğŸ­',free:true},
  {title:'Simulizi: Mama Aliyepigana',desc:'Hadithi ya kweli ya nguvu za mama',icon:'ğŸ‘©',free:false,season:1},
  {title:'Uhalifu wa Watu Maarufu',desc:'Mambo wanayofanya nyuma ya pazia',icon:'ğŸ­',free:false,season:1},
  {title:'Mfumo wa Udanganyifu',desc:'Jinsi unavyodanganywa kila siku',icon:'ğŸª',free:false,season:1},
  {title:'Siri za Ndoa',desc:'Mambo ambayo wenzi hawasemi',icon:'ğŸ’',free:false,season:1},
  {title:'Nguvu za Akili',desc:'Jinsi ya kudhibiti mawazo yako',icon:'ğŸ§ ',free:false,season:2},
];

function renderCards(containerId, data, type) {
  const el = document.getElementById(containerId);
  if (!el) return;
  el.innerHTML = data.map(item => `
    <div class="card ${type === 'video' ? 'video-card' : ''}" onclick="openContent('${type}','${item.title}',${item.free ? 'true' : 'false'},'${(item.content||'').replace(/'/g,"\\'")}')">
      <div class="card-img-placeholder">${item.icon}</div>
      <div class="card-body">
        <div class="card-title">${item.title} ${item.free ? '<span class="badge-free">BURE</span>' : '<span class="badge-locked">PREMIUM</span>'}</div>
        <div class="card-desc">${item.desc}</div>
      </div>
      ${!item.free ? '<div class="card-lock">ğŸ”’</div>' : ''}
    </div>
  `).join('');
}

function initCards() {
  renderCards('love-cards', loveStories, 'mapenzi');
  renderCards('thriller-cards', thrillerStories, 'kusisimua');
  renderCards('secret-cards', secretData, 'siri');
  renderCards('video-cards', videoData, 'video');
}

// === NAVIGATION ===
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
}

// === CONTENT OPEN ===
function openContent(type, title, isFree, content) {
  if (isFree) {
    if (type === 'video') { openFreeVideo(); return; }
    openFreeStory(title, content);
    return;
  }
  if (access[type]) {
    openFreeStory(title, 'Maudhui kamili yanapatikana kwa wanachama waliosajiliwa. Hii ni sehemu ya kwanza:\n\n' + (content || 'Maudhui haya yako katika hifadhidata yetu ya premium. Endelea kusoma bila kikwazo chochote...'));
    return;
  }
  currentPaymentType = type;
  document.getElementById('locked-overlay').classList.add('open');
}

function openFreeStory(title, content) {
  document.getElementById('story-title').textContent = title;
  document.getElementById('story-content').innerHTML = content.replace(/\n/g,'<br>');
  document.getElementById('story-overlay').classList.add('open');
}

function closeStory() {
  document.getElementById('story-overlay').classList.remove('open');
}

function openFreeVideo() {
  document.getElementById('video-overlay').classList.add('open');
}

// === PAYMENT ===
const paymentInfo = {
  mapenzi: {title:'ğŸ’Œ Hadithi za Mapenzi â€“ Premium', price:'TZS 5,000 <span>/ mwezi</span>'},
  kusisimua: {title:'âš¡ Hadithi za Kusisimua â€“ Premium', price:'TZS 5,000 <span>/ mwezi</span>'},
  siri: {title:'ğŸ” Siri Nyeti za Dunia â€“ Premium', price:'TZS 10,000 <span>/ mwezi</span>'},
  video: {title:'ğŸ¬ Video Season Pass â€“ Premium', price:'TZS 10,000 <span>/ Season</span>'},
};

function openPayment(type) {
  currentPaymentType = type;
  const info = paymentInfo[type];
  document.getElementById('payment-title').textContent = info.title;
  document.getElementById('payment-price').innerHTML = info.price;
  document.getElementById('confirm-status').style.display = 'none';
  document.getElementById('confirm-success').style.display = 'none';
  document.getElementById('confirm-btn').style.display = 'none';
  document.getElementById('upload-area').querySelector('p').textContent = 'Bonyeza hapa kupakia picha ya muamala wako wa M-PESA';
  document.getElementById('preview-img').style.display = 'none';
  document.getElementById('preview-img').src = '';
  screenshotUploaded = false;
  document.getElementById('payment-overlay').classList.add('open');
  document.getElementById('locked-overlay').classList.remove('open');
}

function openPaymentFromLocked() {
  openPayment(currentPaymentType || 'mapenzi');
}

function closePayment() {
  document.getElementById('payment-overlay').classList.remove('open');
}

function handleScreenshot(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = document.getElementById('preview-img');
    img.src = ev.target.result;
    img.style.display = 'block';
    document.getElementById('upload-area').querySelector('p').textContent = 'âœ… Picha imepakiwa! Bonyeza thibitisha hapa chini.';
    document.getElementById('confirm-btn').style.display = 'block';
    screenshotUploaded = true;
  };
  reader.readAsDataURL(file);
}

function confirmPayment() {
  if (!screenshotUploaded) return;
  document.getElementById('confirm-btn').style.display = 'none';
  document.getElementById('upload-area').style.display = 'none';
  document.getElementById('confirm-status').style.display = 'block';

  setTimeout(() => {
    document.getElementById('confirm-status').style.display = 'none';
    document.getElementById('confirm-success').style.display = 'block';
    // Grant access
    access[currentPaymentType] = true;
    updateUserPage();
  }, 3000);
}

function closeAndUnlock() {
  document.getElementById('payment-overlay').classList.remove('open');
  document.getElementById('upload-area').style.display = 'flex';
  // Go to relevant page
  const map = {mapenzi:'stories',kusisimua:'stories',siri:'secrets',video:'videos'};
  const targetPage = map[currentPaymentType] || 'home';
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(targetPage).classList.add('active');
}

function updateUserPage() {
  const unlocked = Object.entries(access).filter(([k,v]) => v).map(([k]) => k);
  const labels = {mapenzi:'ğŸ’Œ Hadithi za Mapenzi',kusisimua:'âš¡ Hadithi Kusisimua',siri:'ğŸ” Siri Nyeti',video:'ğŸ¬ Video Season'};
  const div = document.getElementById('my-subscriptions');
  if (unlocked.length === 0) {
    div.innerHTML = '<div style="color:#8aa;text-align:center;padding:20px;font-size:0.85rem;">Bado hujalipia maudhui yoyote ya premium</div>';
    document.getElementById('user-status-display').textContent = 'Mwanachama wa Kawaida';
    document.getElementById('user-access-display').textContent = 'Unaweza kufikia maudhui ya bure pekee';
  } else {
    document.getElementById('user-status-display').textContent = 'Mwanachama wa Premium â­';
    document.getElementById('user-access-display').textContent = 'Una ufikiaji wa: ' + unlocked.map(k => labels[k]).join(', ');
    div.innerHTML = unlocked.map(k => `
      <div style="background:var(--glass);border:1px solid var(--gold);border-radius:8px;padding:12px;margin-bottom:10px;display:flex;align-items:center;gap:10px;">
        <span style="font-size:1.5rem;">${labels[k].split(' ')[0]}</span>
        <div>
          <div style="font-family:'Cinzel',serif;color:var(--gold);font-size:0.85rem;">${labels[k]}</div>
          <div style="font-size:0.72rem;color:#0f0;margin-top:2px;">âœ… Imeamilishwa</div>
        </div>
      </div>
    `).join('');
  }
}

// Season tabs
document.querySelectorAll('.season-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.season-tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
  });
});

// Init
initCards();
</script>
</body>
</html>
